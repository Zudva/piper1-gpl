# Cutlist Review UI

Инструмент для ручной проверки и исправления файла `cutlist.jsonl` (этап выравнивания датасета). Позволяет прослушивать сегменты, редактировать текст транскрибации и помечать записи.

## Возможности

*   **Просмотр сегментов**: Навигация по записям из `cutlist.jsonl`.
*   **Воспроизведение аудио**: Проигрывает соответствующий кусок аудиофайла.
*   **Авто-транскрибация**: Использование Whisper для распознавания речи в сегменте.
*   **Smart Gap Detection**: Автоматическое определение временных границ для потерянных (`unmatched`) сегментов.
*   **Редактирование**: Исправление текста, пометка статуса (keep/drop/skip).

## Требования

Для работы инструмента необходимы следующие зависимости:

### Python библиотеки
```bash
pip install gradio soundfile faster-whisper
```
*(Примечание: `faster-whisper` требуется только для функции авто-транскрибации)*

### Системные утилиты
**FFmpeg** — критически важен для работы с аудио.
Скрипт использует `ffmpeg` для того, чтобы "вырезать" нужный кусочек из большого аудиофайла перед отправкой в плеер или на транскрибацию.

Установка на Ubuntu/Debian:
```bash
sudo apt update && sudo apt install ffmpeg
```

## Как работает Smart Gap Detection

Одна из частых проблем при выравнивании — это сегменты со статусом `unmatched`, у которых отсутствуют временные метки (`start=null`, `end=null`).

Инструмент решает эту проблему следующим алгоритмом:
1.  **Поиск контекста**: Скрипт смотрит на соседние записи в `cutlist.jsonl`.
2.  **Вычисление гэпа**:
    *   Берется время окончания (`end`) *предыдущей* фразы (если она из того же файла).
    *   Берется время начала (`start`) *следующей* фразы (если она из того же файла).
    *   Образуется "окно" (gap) между ними.
3.  **Обработка**:
    *   С помощью `ffmpeg` вырезается именно этот кусочек аудио.
    *   Этот кусочек загружается в плеер для прослушивания.
    *   При нажатии "Auto-Transcribe" именно этот кусочек отправляется в Whisper.

В интерфейсе такие сегменты помечаются предупреждением: `⚠️ Times Guessed`.

## Запуск

```bash
python script/cutlist_review_ui.py \
  --cutlist path/to/cutlist.jsonl \
  --audio-root path/to/wavs \
  --host 127.0.0.1 \
  --port 7860
```
