# –û—Ç—á—ë—Ç: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –æ–±—É—á–µ–Ω–∏—è –≥–æ–ª–æ—Å–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 12 —è–Ω–≤–∞—Ä—è 2026  
**–ü—Ä–æ–µ–∫—Ç:** piper1-gpl  
**–Ø–∑—ã–∫:** –†—É—Å—Å–∫–∏–π (ru)  
**–ì–æ–ª–æ—Å:** felix_mirage  

---

## 1. –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞ ‚úÖ –ì–û–¢–û–í–û

### –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
```
/workspace/datasets/felix_mirage/
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ê—É–¥–∏–æ—Ñ–∞–π–ª—ã** | 8,397 —Ñ–∞–π–ª–æ–≤ (—Å–æ–≤–ø–∞–¥–∞—é—Ç —Å metadata_2col.csv) |
| **–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä** | 18 GB |
| **–§–æ—Ä–º–∞—Ç** | WAV, 22,050 Hz (–º–æ–Ω–æ—Ñ–æ–Ω–∏—á–µ—Å–∫–∏–π) |
| **–†–∞–∑–º–µ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö** | ~1.8 MB (2-–∫–æ–ª–æ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: `path\|text`) |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫
```
felix_mirage/
‚îú‚îÄ‚îÄ wavs/                          # 8,397 –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤ (felix_XXXXXX.wav)
‚îú‚îÄ‚îÄ .cache/                        # –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∫–µ—à –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (~6.4 GB)
‚îú‚îÄ‚îÄ metadata_2col.csv              # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö ‚úì
‚îú‚îÄ‚îÄ metadata.csv                   # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ config.json                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è ‚úì
```

### –ö–∞—á–µ—Å—Ç–≤–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
```
‚úì –§–æ—Ä–º–∞—Ç: audio_path|text (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
‚úì –ö–æ–¥–∏—Ä–æ–≤–∫–∞: UTF-8 (—Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç)
‚úì –ü—Ä–∏–º–µ—Ä—ã (–ø–µ—Ä–≤—ã–µ 3 —Å—Ç—Ä–æ–∫–∏):
  - felix_000000.wav|–ó–∞–º–µ—Ç—å—Ç–µ, –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –≤–µ—â—å: —Ü–∏—Ñ—Ä–æ–≤—ã–µ –∑–∞–≤–µ—â–∞–Ω–∏—è...
  - felix_000001.wav|–í –¥–∞—Ç–∞-–∫–∞–ø—Å—É–ª—ã —É–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏...
  - felix_000002.wav|–≠—Ç–æ —á–µ–º-—Ç–æ –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –º–æ—ë —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ "–ø—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏–µ"...
‚úì –í–∞–ª–∏–¥–∞—Ü–∏—è: –í—Å–µ 8,397 —Ñ–∞–π–ª–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∑–∞–ø–∏—Å—è–º –≤ metadata_2col.csv
```

### –û—Ü–µ–Ω–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –¥–∞—Ç–∞—Å–µ—Ç–∞
- **–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö**: 18 GB ‚âà **~8-9 —á–∞—Å–æ–≤ —Ä–µ—á–∏** (—Ö–æ—Ä–æ—à–∏–π –¥–∞—Ç–∞—Å–µ—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è TTS)
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤**: 8,397 ‚úì (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏ VITS)
- **–ö–∞—á–µ—Å—Ç–≤–æ —Ç–µ–∫—Å—Ç–æ–≤**: –†—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ ‚úì
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–µ—à–∞**: –û–±—Ä–∞–±–æ—Ç–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é ‚úì

---

## 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è ‚úÖ –ì–û–¢–û–í–û

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —è–∑—ã–∫–∞ –∏ –∞—É–¥–∏–æ
```json
{
  "audio": {
    "sample_rate": 22050           // ‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏
  },
  "espeak": {
    "voice": "ru"                  // ‚úì –†—É—Å—Å–∫–∏–π —è–∑—ã–∫ (espeak-ng)
  },
  "phoneme_type": "espeak",        // ‚úì –§–æ–Ω–µ–º–∏–∑–∞—Ü–∏—è espeak
  "num_symbols": 256,              // ‚úì –†–∞–∑–º–µ—Ä —Å–ª–æ–≤–∞—Ä—è —Å–∏–º–≤–æ–ª–æ–≤
  "num_speakers": 1                // ‚úì –û–¥–Ω–æ–¥–∏–∫—Ç–æ—Ä–Ω–∞—è –º–æ–¥–µ–ª—å
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è (train_resume.sh)
```bash
batch_size=16                      # ‚úì –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –Ω–∞ GPU
max_epochs=10000                   # ‚úì –ú–∞–∫—Å–∏–º—É–º —ç–ø–æ—Ö (—Ç–µ–∫—É—â–∏–µ: 426-649)
trainer.check_val_every_n_epoch=1  # ‚úì –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞–∂–¥—É—é —ç–ø–æ—Ö—É
trainer.strategy=ddp_find_unused_parameters_true  # ‚úì DDP –¥–ª—è 2 GPU
trainer.devices=2                  # ‚úì –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ 2 GPU
trainer.accelerator=gpu            # ‚úì GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ (CUDA 12.1)
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ (inference)
```json
{
  "noise_scale": 0.667,            // –ö–æ–Ω—Ç—Ä–æ–ª—å —Ñ–æ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–π –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏
  "length_scale": 1.0,             // –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–µ—á–∏
  "noise_w": 0.8                   // –ö–æ–Ω—Ç—Ä–æ–ª—å –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã mel-—Å–ø–µ–∫—Ç—Ä–æ–≥—Ä–∞–º–º—ã
```json
{
  "hop_length": 256,               // –°–º–µ—â–µ–Ω–∏–µ –∫–∞–¥—Ä–∞
  "piper_version": "1.3.0"         // –í–µ—Ä—Å–∏—è –º–æ–¥–µ–ª–∏
}
```

---

## 3. –°–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤ ‚úÖ –ì–û–¢–û–í–û

### –û—Å–Ω–æ–≤–Ω–æ–π —á–µ–∫–ø–æ–∏–Ω—Ç
```
/workspace/piper1-gpl/lightning_logs/version_2/checkpoints/
‚îú‚îÄ‚îÄ epoch=426-step=202398.ckpt        (807 MB, –≥–æ—Ç–æ–≤ –∫ resume)
```

### –ò—Å—Ç–æ—Ä–∏—è –æ–±—É—á–µ–Ω–∏—è
| –í–µ—Ä—Å–∏—è | –≠–ø–æ—Ö–∞ | –†–∞–∑–º–µ—Ä | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|--------|-------|--------|--------|-----------|
| version_0 | - | - | –ó–∞–∫–æ–Ω—á–µ–Ω–∞ | –†–∞–Ω–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ |
| version_1-6 | - | - | –ó–∞–∫–æ–Ω—á–µ–Ω–∞ | –ü–æ–ø—ã—Ç–∫–∏ resume |
| **version_2** | **426** | **807 MB** | ‚úì –ê–∫—Ç–∏–≤–Ω–∞ | **–û—Å–Ω–æ–≤–Ω–æ–π —á–µ–∫–ø–æ–∏–Ω—Ç –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è** |

### ONNX —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
```
felix_mirage_epoch426.onnx         (61 MB, –≥–æ—Ç–æ–≤–∞ –∫ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å—É)
‚îú‚îÄ‚îÄ felix_mirage_epoch426.onnx.json  (–∫–æ–Ω—Ñ–∏–≥)
‚îÇ
felix_mirage_epoch649.onnx         (61 MB, –±–æ–ª–µ–µ –ø–æ–∑–¥–Ω—è—è –≤–µ—Ä—Å–∏—è)
‚îú‚îÄ‚îÄ felix_mirage_epoch649.onnx.json  (–∫–æ–Ω—Ñ–∏–≥)
```

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—é –æ–±—É—á–µ–Ω–∏—è
```
‚úì –ß–µ–∫–ø–æ–∏–Ω—Ç epoch=426 —Ü–µ–ª–æ—Å—Ç–µ–Ω (807 MB)
‚úì –ü—É—Ç–∏ –≤ train_resume.sh –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
‚úì –í–µ—Ä—Å–∏—è version_2 —Å—Ç–∞–±–∏–ª—å–Ω–∞
‚úì –ú–æ–∂–Ω–æ –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ —Å —ç–ø–æ—Ö–∏ 426
```

---

## 4. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚úÖ –ì–û–¢–û–í–û

### Core Dependencies (train extras)
| –ü–∞–∫–µ—Ç | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|--------|-----------|
| **torch** | >=2, <3 | PyTorch 2.x —Å CUDA 12.1 |
| **lightning** | >=2, <3 | PyTorch Lightning 2.x (–æ–±—É—á–µ–Ω–∏–µ) |
| **tensorboard** | >=2, <3 | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ |
| **onnx** | >=1, <2 | –≠–∫—Å–ø–æ—Ä—Ç ONNX –º–æ–¥–µ–ª–µ–π |
| **librosa** | <1 | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ |
| **onnxruntime** | >=1, <2 | –ò–Ω—Ñ–µ—Ä–µ–Ω—Å ONNX |

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
| –ü–∞–∫–µ—Ç | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|--------|-----------|
| **jsonargparse** | >=4.27.7 | CLI –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è Lightning |
| **pysilero-vad** | >=2.1, <3 | –î–µ—Ç–µ–∫—Ü–∏—è –≥–æ–ª–æ—Å–∞ |
| **cython** | >=3, <4 | –ö–æ–º–ø–∏–ª—è—Ü–∏—è C —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π |
| **onnxscript** | >=0.1 | ONNX —Å–∫—Ä–∏–ø—Ç–∏–Ω–≥ |

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Docker)
```bash
build-essential                     # C/C++ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä
cmake                               # CMake –¥–ª—è —Å–±–æ—Ä–∫–∏
ninja-build                         # Ninja –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏
espeak-ng                           # Text-to-phoneme (—Ä—É—Å—Å–∫–∏–π ‚úì)
python3-venv                        # –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PyTorch
```bash
PyTorch 2.3.1 —Å CUDA 12.1           # –£–∫–∞–∑–∞–Ω–æ –≤ deploy/compose/docker-compose.train.yml
–£—Å—Ç–∞–Ω–æ–≤–∫–∞: pip install torch==2.3.1 --index-url https://download.pytorch.org/whl/cu121
```

---

## 5. –°—Ä–µ–¥–∞ –æ–±—É—á–µ–Ω–∏—è (Docker) ‚úÖ –ì–û–¢–û–í–û

### Docker Compose Configuration
```yaml
service: piper-train
image: nvcr.io/nvidia/pytorch:24.04-py3  # –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ —Å CUDA 12.1
runtime: nvidia                          # ‚úì NVIDIA runtime –≤–∫–ª—é—á–µ–Ω
network_mode: host                       # ‚úì –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ç–∏
```

### GPU Configuration
```yaml
environment:
  - NVIDIA_VISIBLE_DEVICES=0,1            # ‚úì GPU 0 –∏ 1
  - NVIDIA_DRIVER_CAPABILITIES=compute,utility  # ‚úì Compute —Ä–µ–∂–∏–º
ipc: host                                 # ‚úì IPC –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π
```

### Volume Mounting
```yaml
volumes:
  - .:/workspace/piper1-gpl              # –†–∞–±–æ—á–∞—è –ø–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
  - ${DATA_DIR:-/workspace/datasets/felix_mirage}:/data  # –î–∞—Ç–∞—Å–µ—Ç ‚úì
  - ${CHECKPOINTS_DIR:-/workspace/checkpoints}:/checkpoints:ro  # –ß–µ–∫–ø–æ–∏–Ω—Ç—ã (read-only)
  - piper-venv:/tmp/piper-venv           # –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ (persistent)
```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ä–µ–¥—ã
```bash
‚úì –°–æ–∑–¥–∞–Ω–∏–µ venv: /tmp/piper-venv (persistent volume)
‚úì –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PyTorch 2.3.1 —Å CUDA 12.1
‚úì –°–±–æ—Ä–∫–∞ C —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (build_monotonic_align.sh)
‚úì –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤: /workspace/piper1-gpl/logs/install_and_export.log
```

---

## 6. –°–∫—Ä–∏–ø—Ç—ã –æ–±—É—á–µ–Ω–∏—è ‚úÖ –ì–û–¢–û–í–û

### train_resume.sh (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç)
```bash
#!/bin/bash
# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
# $1 - –ø—É—Ç—å –∫ —á–µ–∫–ø–æ–∏–Ω—Ç—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: lightning_logs/version_2/checkpoints/epoch=426-step=202398.ckpt)
# $2 - –º–∞–∫—Å–∏–º—É–º —ç–ø–æ—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10000)

# –ö–æ–º–∞–Ω–¥–∞ –æ–±—É—á–µ–Ω–∏—è:
python -m piper.train fit \
    --ckpt_path="$CHECKPOINT"                       # ‚úì Resume –∏–∑ —á–µ–∫–ø–æ–∏–Ω—Ç–∞
    --data.config_path="$DATA_DIR/config.json"      # ‚úì –ö–æ–Ω—Ñ–∏–≥ –æ–±—É—á–µ–Ω–∏—è
    --data.voice_name=felix_mirage                  # ‚úì –ò–º—è –≥–æ–ª–æ—Å–∞
    --data.csv_path="$DATA_DIR/metadata_2col.csv"   # ‚úì –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    --data.audio_dir="$DATA_DIR/wavs"               # ‚úì –ê—É–¥–∏–æ—Ñ–∞–π–ª—ã
    --model.sample_rate=22050                       # ‚úì 22.05 kHz
    --data.espeak_voice=ru                          # ‚úì –†—É—Å—Å–∫–∏–π —è–∑—ã–∫
    --data.cache_dir="$DATA_DIR/.cache"             # ‚úì –ö–µ—à –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    --data.batch_size=16                            # ‚úì –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
    --trainer.max_epochs="$MAX_EPOCHS"              # ‚úì –ú–∞–∫—Å–∏–º—É–º —ç–ø–æ—Ö
    --trainer.check_val_every_n_epoch=1             # ‚úì –í–∞–ª–∏–¥–∞—Ü–∏—è
    --trainer.strategy=ddp_find_unused_parameters_true  # ‚úì DDP —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
    --trainer.devices=2                             # ‚úì 2 GPU
    --trainer.accelerator=gpu                       # ‚úì GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ
```

### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ ONNX
```bash
EXPORT_ONLY=1 \
CHECKPOINT=/workspace/piper1-gpl/lightning_logs/version_2/checkpoints/epoch=426-step=202398.ckpt \
OUTPUT_FILE=/workspace/piper1-gpl/felix_mirage_epoch426.onnx \
docker compose -f deploy/compose/docker-compose.train.yml run --rm \
  -e EXPORT_ONLY -e CHECKPOINT -e OUTPUT_FILE piper-train
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
python test_onnx_generate.py \
  --model felix_mirage_epoch426.onnx \
  --text "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç –≥–æ–ª–æ—Å–∞."

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
python test_onnx_variations.py \
  --text "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–∑–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–æ–ª–æ—Å–∞."
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è
```bash
# TensorBoard (–º–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)
tensorboard --logdir lightning_logs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤
ls -lh lightning_logs/version_*/checkpoints/
```

---

## 7. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ VITS ‚úÖ –í–ê–õ–ò–î–ò–†–û–í–ê–ù–ê

### Pipeline –æ–±—É—á–µ–Ω–∏—è
```
–í—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç (—Ä—É—Å—Å–∫–∏–π)
    ‚Üì
Espeak-ng —Ñ–æ–Ω–µ–º–∏–∑–∞—Ç–æ—Ä (ru voice)
    ‚Üì
–ú–∞–ø–ø–∏–Ω–≥ ID —Ñ–æ–Ω–µ–º (256 —Å–∏–º–≤–æ–ª–æ–≤)
    ‚Üì
VITS –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä (SynthesizerTrn)
‚îú‚îÄ Text Encoder
‚îú‚îÄ Posterior Encoder
‚îú‚îÄ Decoder (HiFi-GAN Vocoder)
‚îî‚îÄ Duration Predictor
    ‚Üì
–ú—É–ª—å—Ç–∏–ø–µ—Ä–∏–æ–¥–Ω—ã–π –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ç–æ—Ä
    ‚Üì
–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—å
‚îú‚îÄ Mel-—Å–ø–µ–∫—Ç—Ä–æ–≥—Ä–∞–º–º–∞
‚îú‚îÄ Duration prediction
‚îú‚îÄ KL divergence
‚îî‚îÄ Adversarial loss
    ‚Üì
–ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Å–ø—É—Å–∫ (Adam optimizer)
    ‚Üì
–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤–µ—Å–∞ –º–æ–¥–µ–ª–∏
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- ‚úì –§–æ–Ω–µ–º–∏–∑–∞—Ü–∏—è: espeak-ng —Å —Ä—É—Å—Å–∫–∏–º –≥–æ–ª–æ—Å–æ–º (`ru`)
- ‚úì –°–ª–æ–≤–∞—Ä—å: 256 —Ñ–æ–Ω–µ–º (–≤–∫–ª—é—á–∞—è —Ä—É—Å—Å–∫–∏–µ —Ñ–æ–Ω–µ–º—ã –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã)
- ‚úì Audio: 22,050 Hz, mono
- ‚úì Mel-—Å–ø–µ–∫—Ç—Ä–æ–≥—Ä–∞–º–º–∞: hop_length=256, —Ñ–∏–ª—å—Ç—Ä 1024
- ‚úì –û–±—É—á–µ–Ω–∏–µ: VITS —Å DDP –Ω–∞ 2 GPU

---

## 8. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚úÖ –ì–û–¢–û–í–û

### TensorBoard
```
–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ª–æ–≥–æ–≤: lightning_logs/version_2/
–ö–æ–º–∞–Ω–¥–∞: tensorboard --logdir lightning_logs
–ú–µ—Ç—Ä–∏–∫–∏:
  - Loss: generator, discriminator, duration, KL divergence
  - –í–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–∫–∞–∂–¥—É—é —ç–ø–æ—Ö—É)
  - Learning rate schedule
```

### Install –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```
–õ–æ–≥—Ñ–∞–π–ª: /workspace/piper1-gpl/logs/install_and_export.log
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è venv
  - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PyTorch
  - –°–±–æ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
  - –°—Ç–∞—Ç—É—Å —ç–∫—Å–ø–æ—Ä—Ç–∞ ONNX
```

---

## 9. –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ üü¢ –í–°–ï –£–°–õ–û–í–ò–Ø –í–´–ü–û–õ–ù–ï–ù–´

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|----------|--------|--------|
| **–î–∞—Ç–∞—Å–µ—Ç** | ‚úÖ –ì–û–¢–û–í | 8,397 —Ñ–∞–π–ª–æ–≤, 18 GB, —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç |
| **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** | ‚úÖ –í–ê–õ–ò–î–ù–´ | 2-–∫–æ–ª–æ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, UTF-8, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã |
| **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** | ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø | espeak-ng (ru), 22050 Hz, batch_size 16 |
| **–ß–µ–∫–ø–æ–∏–Ω—Ç—ã** | ‚úÖ –¶–ï–õ–û–°–¢–ù–´ | epoch=426-step=202398.ckpt (807 MB) |
| **ONNX –º–æ–¥–µ–ª–∏** | ‚úÖ –≠–ö–°–ü–û–†–¢–ò–†–û–í–ê–ù–´ | Epoch 426 –∏ 649 –≥–æ—Ç–æ–≤—ã –∫ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å—É |
| **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** | ‚úÖ –£–°–¢–ê–ù–û–í–õ–ï–ù–´ | PyTorch 2.3.1, CUDA 12.1, Lightning 2.x |
| **Docker —Å—Ä–µ–¥–∞** | ‚úÖ –ù–ê–°–¢–†–û–ï–ù–ê | NVIDIA runtime, GPU 0,1, volumes –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã |
| **–°–∫—Ä–∏–ø—Ç—ã** | ‚úÖ –í–ê–õ–ò–î–ù–´ | train_resume.sh, test —Å–∫—Ä–∏–ø—Ç—ã, –ø—É—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã |
| **GPU –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** | ‚úÖ –ê–ö–¢–ò–í–ù–ê | 2 GPU (DDP), NVIDIA_VISIBLE_DEVICES=0,1 |
| **TensorBoard** | ‚úÖ –ì–û–¢–û–í | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ lightning_logs/version_2/ |

---

## 10. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—é –æ–±—É—á–µ–Ω–∏—è

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /workspace/piper1-gpl

# –ú–µ—Ç–æ–¥ 1: –õ–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ä—Ç (–µ—Å–ª–∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ)
source .venv/bin/activate
./train_resume.sh

# –ú–µ—Ç–æ–¥ 2: Docker –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
docker compose -f deploy/compose/docker-compose.train.yml up --rm piper-train
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è
```bash
# –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å epoch=426 –¥–æ max_epochs=10000
./train_resume.sh

# –ò–ª–∏ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
./train_resume.sh lightning_logs/version_2/checkpoints/epoch=426-step=202398.ckpt 15000
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
```bash
# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
tensorboard --logdir /workspace/piper1-gpl/lightning_logs
# –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:6006
```

### –≠–∫—Å–ø–æ—Ä—Ç –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
```bash
# –ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –¥–æ –∂–µ–ª–∞–µ–º–æ–π —ç–ø–æ—Ö–∏
EXPORT_ONLY=1 \
CHECKPOINT=/workspace/piper1-gpl/lightning_logs/version_2/checkpoints/epoch=NEW_EPOCH.ckpt \
OUTPUT_FILE=/workspace/piper1-gpl/felix_mirage_epochNEW.onnx \
docker compose -f deploy/compose/docker-compose.train.yml run --rm -e EXPORT_ONLY -e CHECKPOINT -e OUTPUT_FILE piper-train
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è
```bash
python test_onnx_variations.py \
  --text "–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–æ–≥–æ –≥–æ–ª–æ—Å–∞ –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —ç–ø–æ—Ö–∞—Ö."
```

---

## 11. –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—É—á–µ–Ω–∏—è**: –ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ –¥–æ —ç–ø–æ—Ö–∏ 649, –Ω–æ –æ—Å–Ω–æ–≤–Ω–æ–π —á–µ–∫–ø–æ–∏–Ω—Ç version_2 ‚Äì —ç—Ç–æ epoch=426.

2. **–¢—Ä–µ–±—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã**:
   - 2x GPU (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è RTX 4090 –∏–ª–∏ –≤—ã—à–µ)
   - ~20 GB VRAM –Ω–∞ GPU (–¥–ª—è batch_size=16)
   - ~25-30 GB –ø–∞–º—è—Ç–∏ –Ω–∞ –¥–∏—Å–∫–µ –¥–ª—è —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤

3. **–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è**: –ü—Ä–∏–º–µ—Ä–Ω–æ 24-48 —á–∞—Å–æ–≤ –Ω–∞ 2x GPU –¥–ª—è 1000 —ç–ø–æ—Ö (–æ—Ç —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ 426 –¥–æ 1426).

4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–∞—è —Å—Ö–æ–¥–∏–º–æ—Å—Ç—å, –º–æ–∂–Ω–æ:
   - –£–≤–µ–ª–∏—á–∏—Ç—å `batch_size` (–µ—Å–ª–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç VRAM)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å learning rate scheduling
   - –î–æ–±–∞–≤–∏—Ç—å –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö

5. **–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è**: –†–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —á–µ–∫–ø–æ–∏–Ω—Ç—ã –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ ONNX –º–æ–¥–µ–ª–∏.

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ **–í–°–ï –£–°–õ–û–í–ò–Ø –û–ë–£–ß–ï–ù–ò–Ø –ì–û–õ–û–°–ê –ù–ê –†–£–°–°–ö–û–ú –Ø–ó–´–ö–ï –°–û–ë–õ–Æ–î–ï–ù–´ –ò –ì–û–¢–û–í–´ –ö –ó–ê–ü–£–°–ö–£**

–ü—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∏–¥–µ–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –î–∞—Ç–∞—Å–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (8+ —á–∞—Å–æ–≤), –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è (espeak-ng —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫), –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ (Docker —Å GPU –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π), –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–µ–∫–ø–æ–∏–Ω—Ç (epoch 426) –≥–æ—Ç–æ–≤ –∫ resume –æ–±—É—á–µ–Ω–∏—è.

–ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å `./train_resume.sh` –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏.

---

**–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞:** 12 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –û–ë–£–ß–ï–ù–ò–Æ
